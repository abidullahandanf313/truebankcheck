<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>True Validator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    },
                    colors: {
                        'dark-blue': '#0f172a',
                        'neon-blue': '#3b82f6',
                        'neon-green': '#10b981',
                        'neon-purple': '#8b5cf6',
                    }
                }
            }
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #f8fafc;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .input-field {
            transition: all 0.3s ease;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .input-field:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(51, 65, 85, 0.7);
            transform: translateY(-3px);
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            opacity: 0.3;
            animation: float 15s infinite linear;
        }
        
        .policy-link {
            position: relative;
            transition: all 0.3s ease;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .policy-link:hover {
            color: #3b82f6;
        }
        
        .policy-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background: #3b82f6;
            transition: width 0.3s ease;
        }
        
        .policy-link:hover::after {
            width: 100%;
        }
        
        .footer {
            margin-top: auto;
            padding: 1rem;
            width: 100%;
            text-align: center;
        }
        
        .searching-animation {
            display: inline-block;
            width: 20px;
            text-align: left;
        }
        
        .searching-animation::after {
            content: '...';
            animation: searching 1.5s infinite;
        }
        
        @keyframes searching {
            0% { content: '.'; }
            33% { content: '..'; }
            66% { content: '...'; }
        }
        
        @keyframes float {
            0%, 100% { 
                transform: translateY(0) translateX(0) rotate(0deg); 
            }
            25% { 
                transform: translateY(-20px) translateX(10px) rotate(5deg); 
            }
            50% { 
                transform: translateY(-10px) translateX(20px) rotate(0deg); 
            }
            75% { 
                transform: translateY(-15px) translateX(-10px) rotate(-5deg); 
            }
        }
        
        .particle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            opacity: 0.3;
            animation: float 20s infinite ease-in-out;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-button {
            flex: 1;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border: none;
            color: #f8fafc;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .tab-button.active {
            background: rgba(59, 130, 246, 0.2);
            border-bottom-color: #3b82f6;
            color: #3b82f6;
        }

        .tab-button:hover {
            background: rgba(59, 130, 246, 0.1);
        }
    </style>
</head>
<body class="min-h-screen p-4">
    <!-- Animated background particles -->
    <div class="fixed inset-0 overflow-hidden z-0" id="particles-container"></div>

    <div class="flex flex-col items-center justify-center flex-grow z-10">
        <div class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-black bg-clip-text text-transparent bg-gradient-to-r from-neon-blue to-neon-purple mb-2">True Validator</h1>
            <p class="text-slate-400">Verify your payment details securely</p>
        </div>

        <!-- Tabs Navigation -->
        <div class="w-full max-w-lg mb-6 flex bg-slate-900 bg-opacity-50 backdrop-blur-lg rounded-xl overflow-hidden">
            <button class="tab-button active" onclick="switchTab('card')">
                <i class="fas fa-credit-card mr-2"></i> Card Validator
            </button>
            <button class="tab-button" onclick="switchTab('account')">
                <i class="fas fa-university mr-2"></i> Account Validator
            </button>
        </div>

        <!-- Card Validator Tab -->
        <div id="card-tab" class="tab-content active w-full max-w-lg bg-slate-900 bg-opacity-50 backdrop-blur-lg rounded-2xl p-6 shadow-xl z-10 mb-8">
            <!-- Updated Card Validator Content -->
            <form id="cardForm" class="space-y-5">
                <div>
                    <label for="cardNumber" class="block text-sm font-medium text-slate-300 mb-2">Card Number</label>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="cardNumber" 
                            maxlength="19" 
                            class="w-full p-4 input-field rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-0"
                            placeholder="Enter your card number"
                            autocomplete="off"
                        >
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400" id="cardIcon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                    </div>
                    <div id="searchingText" class="text-md font-medium text-slate-300 mt-3 hidden">
                        <span class="searching-animation"></span> Validating
                    </div>
                </div>
                
                <div class="pt-4 flex gap-4">
                    <button 
                        type="button" 
                        id="validateBtn"
                        class="flex-1 py-4 btn-primary text-white font-semibold rounded-xl transition-all duration-300 flex items-center justify-center"
                    >
                        <span id="validateText">Validate Card</span>
                        <span id="spinner" class="ml-2 hidden">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                    
                    <button 
                        type="button" 
                        onclick="clearForm()"
                        class="flex-1 py-4 btn-secondary text-white font-semibold rounded-xl transition-all duration-300"
                    >
                        Clear
                    </button>
                </div>
            </form>
            
            <div id="result" class="mt-6 p-4 rounded-xl text-center font-medium text-lg hidden" role="alert"></div>
        </div>

        <!-- Account Validator Tab -->
        <div id="account-tab" class="tab-content w-full max-w-lg bg-slate-900 bg-opacity-50 backdrop-blur-lg rounded-2xl p-6 shadow-xl z-10 mb-8">
            <!-- Account Validator Content (from index.html) -->
            <form id="accountForm" class="space-y-5">
                <div>
                    <label for="routingNumber" class="block text-sm font-medium text-slate-300 mb-2">Routing Number</label>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="routingNumber" 
                            maxlength="9" 
                            class="w-full p-4 input-field rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-0"
                            placeholder="Enter routing number"
                            autocomplete="off"
                        >
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400" id="routingIcon">
                            <i class="fas fa-university"></i>
                        </div>
                    </div>
                </div>
                <div>
                    <label for="accountNumber" class="block text-sm font-medium text-slate-300 mb-2">Account Number</label>
                    <div class="relative">
                        <input 
                            type="text" 
                            id="accountNumber" 
                            maxlength="17" 
                            class="w-full p-4 input-field rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-0"
                            placeholder="Enter account number"
                            autocomplete="off"
                        >
                        <div class="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400" id="accountIcon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                    </div>
                    <div id="accountSearchingText" class="text-md font-medium text-slate-300 mt-3 hidden">
                        <span class="searching-animation"></span> Validating
                    </div>
                </div>
                
                <div class="pt-4 flex gap-4">
                    <button 
                        type="button" 
                        id="validateAccountBtn"
                        class="flex-1 py-4 btn-primary text-white font-semibold rounded-xl transition-all duration-300 flex items-center justify-center"
                    >
                        <span id="validateAccountText">Validate Account</span>
                        <span id="accountSpinner" class="ml-2 hidden">
                            <i class="fas fa-spinner fa-spin"></i>
                        </span>
                    </button>
                    
                    <button 
                        type="button" 
                        id="clearAccountBtn"
                        class="flex-1 py-4 btn-secondary text-white font-semibold rounded-xl transition-all duration-300"
                    >
                        Clear
                    </button>
                </div>
            </form>
            
            <div id="accountResult" class="mt-6 p-4 rounded-xl hidden" role="alert">
                <!-- Success Table (hidden by default) -->
                <div id="successTable" class="hidden">
                    <div class="bg-green-900 bg-opacity-50 backdrop-blur-sm rounded-xl p-4">
                        <h3 class="text-lg font-semibold text-green-200 mb-4 text-center">Valid Bank Account</h3>
                        <table class="w-full text-sm text-left text-slate-300 border-separate border-spacing-y-2">
                            <thead class="text-xs uppercase text-green-100">
                                <tr>
                                    <th class="py-2 px-4 text-right font-medium">Field</th>
                                    <th class="py-2 px-4">Value</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-slate-800 bg-opacity-50 rounded-lg">
                                    <th class="py-3 px-4 text-right font-medium text-slate-300">Bank Name</th>
                                    <td id="bankNameValue" class="py-3 px-4 font-semibold text-green-200">Loading...</td>
                                </tr>
                                <tr class="bg-slate-800 bg-opacity-50 rounded-lg">
                                    <th class="py-3 px-4 text-right font-medium text-slate-300">Bank Address</th>
                                    <td id="bankAddressValue" class="py-3 px-4 text-slate-200">Loading...</td>
                                </tr>
                                <tr class="bg-slate-800 bg-opacity-50 rounded-lg">
                                    <th class="py-3 px-4 text-right font-medium text-slate-300">ACH Transfer</th>
                                    <td id="achValue" class="py-3 px-4 text-green-400">
                                        <i class="fas fa-check-circle mr-2"></i>Supported
                                    </td>
                                </tr>
                                <tr class="bg-slate-800 bg-opacity-50 rounded-lg">
                                    <th class="py-3 px-4 text-right font-medium text-slate-300">Wire Transfer</th>
                                    <td id="wireValue" class="py-3 px-4 text-green-400">
                                        <i class="fas fa-check-circle mr-2"></i>Supported
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Error Message (fallback for invalid) -->
                <div id="errorMessage" class="bg-red-900 text-red-200 p-4 rounded-xl text-center font-medium hidden">Not Valid</div>
            </div>
        </div>
    </div>

    <div class="footer flex justify-center space-x-6 text-slate-400 z-10">
        <a href="#" class="policy-link" onclick="showPrivacyPolicy()">
            <i class="fas fa-lock text-xs"></i>
            <span>Privacy Policy</span>
        </a>
        <a href="#" class="policy-link" onclick="showTermsConditions()">
            <i class="fas fa-file-alt text-xs"></i>
            <span>Terms & Conditions</span>
        </a>
    </div>

    <!-- Modals (Combined for both tabs) -->
    <div id="privacyModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-slate-800 rounded-2xl max-w-md w-full mx-4 p-6 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Privacy Policy</h3>
                <button onclick="closeModal('privacyModal')" class="text-slate-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="text-slate-300 text-sm space-y-4">
                <p><strong>Effective Date: 09/04/2025</strong></p>
                <p>Payment Validator ("we," "our," or "us") operates simple Card and Account Validator tools. Protecting your privacy is important to us. This policy explains how we handle information when you use our website.</p>
                
                <h4 class="font-semibold text-white mt-4">1. Information We Collect</h4>
                <p><strong>Card/Account Input:</strong></p>
                <p>Our tools only check formats and do not store, log, or save entered details.</p>
                
                <p><strong>Non-Personal Data:</strong></p>
                <p>Basic information like browser type, device, and IP address may be automatically collected for site analytics.</p>
                
                <h4 class="font-semibold text-white mt-4">2. How We Use Information</h4>
                <p>To provide real-time validity results.</p>
                <p>To maintain and improve our website performance.</p>
                <p>To prevent abuse or misuse of our tools.</p>
                
                <h4 class="font-semibold text-white mt-4">3. Data Protection</h4>
                <p>Inputs are processed instantly and discarded; they are never saved.</p>
                <p>Our site uses encryption (HTTPS) to protect communication.</p>
                
                <h4 class="font-semibold text-white mt-4">4. Sharing Information</h4>
                <p>We do not sell, trade, or share any details. Non-personal data may be shared with trusted service providers.</p>
                
                <h4 class="font-semibold text-white mt-4">5. Children's Privacy</h4>
                <p>This website is not intended for children under 13.</p>
                
                <h4 class="font-semibold text-white mt-4">6. Updates</h4>
                <p>We may update this Privacy Policy from time to time. The latest version will always be posted here.</p>
                
                <h4 class="font-semibold text-white mt-4">7. Contact Us</h4>
                <p>📧 Email: kudelacynthia@gmail.com</p>
                <p>Helpline Phone Number: +18063045912</p>
            </div>
        </div>
    </div>

    <div id="termsModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden">
        <div class="bg-slate-800 rounded-2xl max-w-md w-full mx-4 p-6 max-h-[80vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-white">Terms & Conditions</h3>
                <button onclick="closeModal('termsModal')" class="text-slate-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="text-slate-300 text-sm space-y-4">
                <p><strong>Effective Date: 09/04/2025</strong></p>
                <p>These Terms govern your use of our Payment Validator tools. By using the site, you agree to the following:</p>
                
                <h4 class="font-semibold text-white mt-4">1. Purpose of Service</h4>
                <p>Our tools only check structural validity and do not confirm activity or legitimacy.</p>
                
                <h4 class="font-semibold text-white mt-4">2. Acceptable Use</h4>
                <p>You agree not to:</p>
                <p>Use the tools for fraud, phishing, or any illegal activity.</p>
                <p>Enter stolen or unauthorized details.</p>
                <p>Attempt to hack, disrupt, or misuse the website.</p>
                
                <h4 class="font-semibold text-white mt-4">3. No Warranties</h4>
                <p>The tools are provided "as is" and for educational/informational purposes only.</p>
                <p>We do not guarantee 100% accuracy or availability of the Service.</p>
                
                <h4 class="font-semibold text-white mt-4">4. Limitation of Liability</h4>
                <p>We are not responsible for any misuse of the tools or damages resulting from reliance on its results.</p>
                <p>Use of the Service is entirely at your own risk.</p>
                
                <h4 class="font-semibold text-white mt-4">5. Governing Law</h4>
                <p>These Terms are governed by the laws of Greene County, New York.</p>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Account Validator Script (from index.html)
        const validateAccountBtn = document.getElementById('validateAccountBtn');
        const clearAccountBtn = document.getElementById('clearAccountBtn');
        const routingInput = document.getElementById('routingNumber');
        const accountInput = document.getElementById('accountNumber');
        const accountResultDiv = document.getElementById('accountResult');
        const accountSearchingText = document.getElementById('accountSearchingText');
        const accountSpinner = document.getElementById('accountSpinner');
        const validateAccountText = document.getElementById('validateAccountText');

        // Function to handle account validation
        async function validateAccount() {
            const routing = routingInput.value.trim();
            const account = accountInput.value.trim();

            if (!routing || !account) {
                document.getElementById('errorMessage').classList.remove('hidden');
                document.getElementById('successTable').classList.add('hidden');
                document.getElementById('errorMessage').innerHTML = 'Please enter both numbers.';
                accountResultDiv.classList.remove('hidden');
                return;
            }

            // Show loading
            validateAccountText.textContent = 'Validating';
            accountSpinner.classList.remove('hidden');
            accountSearchingText.classList.remove('hidden');
            accountResultDiv.classList.remove('hidden');

            try {
                const response = await fetch('/validate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ routingNumber: routing, accountNumber: account })
                });
                const data = await response.json();

                accountSearchingText.classList.add('hidden');

                if (data.valid) {
                    // Hide error, show success table
                    document.getElementById('errorMessage').classList.add('hidden');
                    document.getElementById('successTable').classList.remove('hidden');
                    
                    // Populate table values
                    document.getElementById('bankNameValue').textContent = data.bankName;
                    document.getElementById('bankAddressValue').textContent = data.address;
                } else {
                    // Hide table, show error
                    document.getElementById('successTable').classList.add('hidden');
                    document.getElementById('errorMessage').classList.remove('hidden');
                    document.getElementById('errorMessage').textContent = 'Not Valid';
                }
            } catch (error) {
                accountSearchingText.classList.add('hidden');
                document.getElementById('successTable').classList.add('hidden');
                document.getElementById('errorMessage').classList.remove('hidden');
                document.getElementById('errorMessage').textContent = 'Error: Could not connect to server. Check console for details.';
                console.error(error);
            } finally {
                // Reset button
                validateAccountText.textContent = 'Validate Account';
                accountSpinner.classList.add('hidden');
            }
        }

        validateAccountBtn.addEventListener('click', validateAccount);

        // Enter key support on inputs
        routingInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                validateAccount();
            }
        });

        accountInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                validateAccount();
            }
        });

        clearAccountBtn.addEventListener('click', () => {
            routingInput.value = '';
            accountInput.value = '';
            accountResultDiv.classList.add('hidden');
            accountSearchingText.classList.add('hidden');
            document.getElementById('successTable').classList.add('hidden');
            document.getElementById('errorMessage').classList.add('hidden');
        });

        // Card Validator Script (Updated to match the provided design)
        const cardNumberInput = document.getElementById('cardNumber');
        const cardIcon = document.getElementById('cardIcon');
        const validateBtn = document.getElementById('validateBtn');
        const validateText = document.getElementById('validateText');
        const spinner = document.getElementById('spinner');
        const resultDiv = document.getElementById('result');
        const searchingText = document.getElementById('searchingText');
        
        // Variables for validation timeout
        let validationTimeout = null;
        let isSearching = false;
        
        // Card patterns
        const cardPatterns = {
            visa: /^4[0-9]{12}(?:[0-9]{3})?$/,
            mastercard: /^5[1-5][0-9]{14}$/,
            amex: /^3[47][0-9]{13}$/,
            discover: /^6(?:011|5[0-9]{2})[0-9]{12}$/,
            'diners club': /^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,
            unionpay: /^62[0-9]{14,17}$/,
            'carte blanche': /^389[0-9]{11}$/,
            enroute: /^(2014|2149)[0-9]{11}$/,
            jcb: /^(?:2131|1800|35\d{3})\d{11}$/,
            maestro: /^(5018|5020|5038|6304|6759|6761|6763)[0-9]{8,15}$/,
            solo: /^(6334|6767)[0-9]{12,15}$/,
            switch: /^(4903|4905|4911|4936|6333|6759)[0-9]{12,15}$/,
            'visa electron': /^(4026|417500|4508|4844|4913|4917)[0-9]{12}$/,
            star: /^(5610|560221|560222|560223|560224|560225)[0-9]{10}$/,
            nyce: /^(6011|6012|6506)[0-9]{12}$/,
            accel: /^(6011|6012|6506)[0-9]{12}$/
        };
        
        // Format card number with spaces
        function formatCardNumber(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            const matches = v.match(/\d{4,16}/g);
            const match = matches && matches[0] || '';
            const parts = [];
            
            for (let i = 0, len = match.length; i < len; i += 4) {
                parts.push(match.substring(i, i + 4));
            }
            
            if (parts.length) {
                return parts.join(' ');
            } else {
                return value;
            }
        }
        
        // Detect card type
        function detectCardType(number) {
            number = number.replace(/\s/g, '');
            
            for (const [type, pattern] of Object.entries(cardPatterns)) {
                if (pattern.test(number)) {
                    return type;
                }
            }
            
            return 'unknown';
        }
        
        // Update card UI based on type
        function updateCardUI(type) {
            // Set specific styles based on card type
            switch(type) {
                case 'visa':
                    cardIcon.innerHTML = '<i class="fab fa-cc-visa text-xl"></i>';
                    cardIcon.className = 'absolute right-3 top-1/2 transform -translate-y-1/2 text-[#1A3C87]';
                    break;
                case 'mastercard':
                    cardIcon.innerHTML = '<i class="fab fa-cc-mastercard text-xl"></i>';
                    cardIcon.className = 'absolute right-3 top-1/2 transform -translate-y-1/2 text-[#CC0000]';
                    break;
                case 'amex':
                    cardIcon.innerHTML = '<i class="fab fa-cc-amex text-xl"></i>';
                    cardIcon.className = 'absolute right-3 top-1/2 transform -translate-y-1/2 text-[#006D5D]';
                    break;
                case 'discover':
                    cardIcon.innerHTML = '<i class="fab fa-cc-discover text-xl"></i>';
                    cardIcon.className = 'absolute right-3 top-1/2 transform -translate-y-1/2 text-[#F28C38]';
                    break;
                default:
                    cardIcon.innerHTML = '<i class="fas fa-credit-card"></i>';
                    cardIcon.className = 'absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400';
            }
        }
        
        // Luhn algorithm validation
        function luhnCheck(number) {
            number = number.replace(/\s/g, '');
            let sum = 0;
            let isEven = false;
            
            for (let i = number.length - 1; i >= 0; i--) {
                let digit = parseInt(number[i]);
                
                if (isEven) {
                    digit *= 2;
                    if (digit > 9) digit -= 9;
                }
                
                sum += digit;
                isEven = !isEven;
            }
            
            return sum % 10 === 0;
        }
        
        // Validate card automatically with delay
        function validateCardWithDelay() {
    // Clear any existing timeout
    if (validationTimeout) {
        clearTimeout(validationTimeout);
    }
    
    const cardNumber = cardNumberInput.value.replace(/\s/g, '');
    
    if (!cardNumber) {
        // If no card number, clear any validation state
        resultDiv.classList.add('hidden');
        searchingText.classList.add('hidden');
        isSearching = false;
        return;
    }
    
    // NEW: Only validate when we have 15 or 16 digits
    if (cardNumber.length !== 15 && cardNumber.length !== 16) {
        resultDiv.classList.add('hidden');
        searchingText.classList.add('hidden');
        isSearching = false;
        return;
    }
    
    // Show searching state
    isSearching = true;
    searchingText.classList.remove('hidden');
    resultDiv.classList.add('hidden');
    
    // Set timeout to simulate validation process
    validationTimeout = setTimeout(() => {
        const cardType = detectCardType(cardNumber);
        
        let isValid = true;
        let errors = [];
        
        if (cardNumber.length < 13) {
            errors.push('Card number is too short');
            isValid = false;
        } else if (!luhnCheck(cardNumber)) {
            errors.push('Invalid card number');
            isValid = false;
        }
        
        // Show result
        if (isValid) {
            const displayName = cardType.split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
            resultDiv.textContent = `Valid ${displayName} Card`;
            resultDiv.className = 'mt-6 p-4 rounded-xl text-center font-medium text-lg bg-green-900 bg-opacity-30 text-green-400';
        } else {
            resultDiv.innerHTML = errors.join('<br>');
            resultDiv.className = 'mt-6 p-4 rounded-xl text-center font-medium text-lg bg-red-900 bg-opacity-30 text-red-400';
        }
        
        resultDiv.classList.remove('hidden');
        searchingText.classList.add('hidden');
        isSearching = false;
    }, 1000); // 1 second delay
}
        
        // Clear form
        function clearForm() {
            // Clear any pending validation
            if (validationTimeout) {
                clearTimeout(validationTimeout);
            }
            
            cardNumberInput.value = '';
            resultDiv.classList.add('hidden');
            searchingText.classList.add('hidden');
            cardIcon.innerHTML = '<i class="fas fa-credit-card"></i>';
            cardIcon.className = 'absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400';
            cardNumberInput.focus();
            isSearching = false;
        }
        
        // Event listeners for card validator
        cardNumberInput.addEventListener('input', (e) => {
            const formatted = formatCardNumber(e.target.value);
            e.target.value = formatted;
            
            const cardType = detectCardType(formatted);
            updateCardUI(cardType);
            
            // Auto-validate as user types with delay
            validateCardWithDelay();
        });
        
        cardNumberInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                validateCardWithDelay();
            }
        });
        
        validateBtn.addEventListener('click', validateCardWithDelay);
        
        // Modal functions
        function showPrivacyPolicy() {
            document.getElementById('privacyModal').classList.remove('hidden');
        }
        
        function showTermsConditions() {
            document.getElementById('termsModal').classList.remove('hidden');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.id === 'privacyModal') {
                closeModal('privacyModal');
            }
            if (e.target.id === 'termsModal') {
                closeModal('termsModal');
            }
        });
        
        // Particles animation
        function createParticles() {
            const container = document.getElementById('particles-container');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 4 + 2 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 20 + 's';
                container.appendChild(particle);
            }
        }
        createParticles();
    </script>
</body>
</html>
